(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{399:function(a,t,s){"use strict";s.r(t);var n=s(13),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"java-缓存框架"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java-缓存框架"}},[a._v("#")]),a._v(" Java 缓存框架")]),a._v(" "),s("blockquote",[s("p",[a._v("关键词：Spring Cache、J2Cache、JetCache")])]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E4%B8%80-jsr-107"}},[a._v("一 、JSR 107")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E4%BA%8Cspring-cache"}},[a._v("二、Spring Cache")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E5%BC%80%E5%90%AF%E7%BC%93%E5%AD%98%E6%B3%A8%E8%A7%A3"}},[a._v("开启缓存注解")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#spring-%E7%BC%93%E5%AD%98%E6%B3%A8%E8%A7%A3-api"}},[a._v("spring 缓存注解 API")])])])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E4%B8%89spring-boot-cache"}},[a._v("三、Spring Boot Cache")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#spring-boot-cache-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"}},[a._v("Spring Boot Cache 快速入门")])])])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E5%9B%9Bjetcache"}},[a._v("四、JetCache")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#jetcache-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"}},[a._v("jetcache 快速入门")])])])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E4%BA%94j2cache"}},[a._v("五、j2cache")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E5%85%AD%E6%80%BB%E7%BB%93"}},[a._v("六、总结")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"}},[a._v("参考资料")])])]),a._v(" "),s("h2",{attrs:{id:"一-、jsr-107"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一-、jsr-107"}},[a._v("#")]),a._v(" 一 、JSR 107")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://www.jcp.org/en/jsr/detail?id=107",target:"_blank",rel:"noopener noreferrer"}},[a._v("JSR107"),s("OutboundLink")],1),a._v(" 中制订了 Java 缓存的规范。")]),a._v(" "),s("p",[a._v("因此，在很多缓存框架、缓存库中，其 API 都参考了 JSR 107 规范。")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://dunwu.test.upcdn.net/snap/20200709174139.png",alt:"img"}})]),a._v(" "),s("p",[a._v("Java Caching 定义了 5 个核心接口")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("CachingProvider")]),a._v(" - 定义了创建、配置、获取、管理和控制多个 "),s("code",[a._v("CacheManager")]),a._v("。一个应用可以在运行期访问多个 "),s("code",[a._v("CachingProvider")]),a._v("。")]),a._v(" "),s("li",[s("strong",[a._v("CacheManager")]),a._v(" - 定义了创建、配置、获取、管理和控制多个唯一命名的 Cache，这些 Cache 存在于 CacheManager 的上下文中。一个 CacheManager 仅被一个 CachingProvider 所拥有。")]),a._v(" "),s("li",[s("strong",[a._v("Cache")]),a._v(" - 是一个类似 Map 的数据结构并临时存储以 Key 为索引的值。一个 Cache 仅被一个 CacheManager 所拥有。")]),a._v(" "),s("li",[s("strong",[a._v("Entry")]),a._v(" - 是一个存储在 Cache 中的 key-value 对。")]),a._v(" "),s("li",[s("strong",[a._v("Expiry")]),a._v(" - 每一个存储在 Cache 中的条目有一个定义的有效期，即 Expiry Duration。一旦超过这个时间，条目为过期的状态。一旦过期，条目将不可访问、更新和删除。缓存有效期可以通过 ExpiryPolicy 设置。")])]),a._v(" "),s("h2",{attrs:{id:"二、spring-cache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、spring-cache"}},[a._v("#")]),a._v(" 二、Spring Cache")]),a._v(" "),s("blockquote",[s("p",[a._v("详见："),s("a",{attrs:{href:"https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/integration.html#cache",target:"_blank",rel:"noopener noreferrer"}},[a._v("Spring Cache 官方文档"),s("OutboundLink")],1)])]),a._v(" "),s("p",[a._v("Spring 作为 Java 开发最著名的框架，也提供了缓存功能的框架—— Spring Cache。")]),a._v(" "),s("p",[a._v("Spring 支持基于注释（annotation）的缓存（cache）技术，它本质上不是一个具体的缓存实现方案（例如：EHCache 或 OSCache），而是一个对缓存使用的抽象，通过在既有代码中添加少量它定义的各种 annotation，即能够达到缓存方法的返回对象的效果。")]),a._v(" "),s("p",[a._v("Spring Cache 的特点：")]),a._v(" "),s("ul",[s("li",[a._v("通过缓存注解即可支持缓存功能")]),a._v(" "),s("li",[a._v("支持 Spring EL 表达式")]),a._v(" "),s("li",[a._v("支持 AspectJ")]),a._v(" "),s("li",[a._v("支持自定义 key 和缓存管理")])]),a._v(" "),s("h3",{attrs:{id:"开启缓存注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启缓存注解"}},[a._v("#")]),a._v(" 开启缓存注解")]),a._v(" "),s("p",[a._v("Spring 为缓存功能提供了注解功能，但是你必须启动注解。")]),a._v(" "),s("p",[a._v("有两种方式：")]),a._v(" "),s("p",[a._v("（一）使用标记注解 "),s("code",[a._v("@EnableCaching")])]),a._v(" "),s("p",[a._v("这种方式对于 Spring 或 Spring Boot 项目都适用。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Configuration")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@EnableCaching")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AppConfig")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("（二）在 xml 中声明")]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("cache:")]),a._v("annotation-driven")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("cache-manager")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("cacheManager"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("/>")])]),a._v("\n")])])]),s("h3",{attrs:{id:"spring-缓存注解-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-缓存注解-api"}},[a._v("#")]),a._v(" spring 缓存注解 API")]),a._v(" "),s("p",[a._v("Spring 对缓存的支持类似于对事务的支持。")]),a._v(" "),s("p",[a._v("首先使用注解标记方法，相当于定义了切点，然后使用 Aop 技术在这个方法的调用前、调用后获取方法的入参和返回值，进而实现了缓存的逻辑。")]),a._v(" "),s("h4",{attrs:{id:"cacheable"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cacheable"}},[a._v("#")]),a._v(" @Cacheable")]),a._v(" "),s("p",[s("strong",[s("code",[a._v("@Cacheable")]),a._v(" 用于触发缓存")]),a._v("。")]),a._v(" "),s("p",[a._v("表明所修饰的方法是可以缓存的：当第一次调用这个方法时，它的结果会被缓存下来，在缓存的有效时间内，以后访问这个方法都直接返回缓存结果，不再执行方法中的代码段。")]),a._v(" "),s("p",[a._v("这个注解可以用"),s("code",[a._v("condition")]),a._v("属性来设置条件，如果不满足条件，就不使用缓存能力，直接执行方法。")]),a._v(" "),s("p",[a._v("可以使用"),s("code",[a._v("key")]),a._v("属性来指定 key 的生成规则。")]),a._v(" "),s("h4",{attrs:{id:"cacheput"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cacheput"}},[a._v("#")]),a._v(" @CachePut")]),a._v(" "),s("p",[s("strong",[s("code",[a._v("@CachePut")]),a._v(" 用于更新缓存")]),a._v("。")]),a._v(" "),s("p",[a._v("与"),s("code",[a._v("@Cacheable")]),a._v("不同，"),s("code",[a._v("@CachePut")]),a._v("不仅会缓存方法的结果，还会执行方法的代码段。")]),a._v(" "),s("p",[a._v("它支持的属性和用法都与"),s("code",[a._v("@Cacheable")]),a._v("一致。")]),a._v(" "),s("h4",{attrs:{id:"cacheevict"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cacheevict"}},[a._v("#")]),a._v(" @CacheEvict")]),a._v(" "),s("p",[s("strong",[s("code",[a._v("@CacheEvict")]),a._v(" 用于清除缓存")]),a._v("。")]),a._v(" "),s("p",[a._v("与"),s("code",[a._v("@Cacheable")]),a._v("功能相反，"),s("code",[a._v("@CacheEvict")]),a._v("表明所修饰的方法是用来删除失效或无用的缓存数据。")]),a._v(" "),s("p",[a._v("下面是"),s("code",[a._v("@Cacheable")]),a._v("、"),s("code",[a._v("@CacheEvict")]),a._v("和"),s("code",[a._v("@CachePut")]),a._v("基本使用方法的一个集中展示：")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Service")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserService")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// @Cacheable可以设置多个缓存，形式如：@Cacheable({"books", "isbns"})')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Cacheable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("value"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" key"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"#user.id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),a._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findUserInDB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Cacheable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" condition "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"#user.getId() <= 2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findUserInLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),a._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findUserInDB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@CachePut")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" key "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"#user.getId()"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),a._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateUserInDB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@CacheEvict")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("removeUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),a._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("removeUserInDB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@CacheEvict")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"users"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" allEntries "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("clear")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("removeAllInDB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("h4",{attrs:{id:"caching"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#caching"}},[a._v("#")]),a._v(" @Caching")]),a._v(" "),s("p",[s("strong",[s("code",[a._v("@Caching")]),a._v(" 用于组合定义多种缓存功能")]),a._v("。")]),a._v(" "),s("p",[a._v("如果需要使用同一个缓存注解（"),s("code",[a._v("@Cacheable")]),a._v("、"),s("code",[a._v("@CacheEvict")]),a._v("或"),s("code",[a._v("@CachePut")]),a._v("）多次修饰一个方法，就需要用到"),s("code",[a._v("@Caching")]),a._v("。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Caching")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("evict "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@CacheEvict")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"primary"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@CacheEvict")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cacheNames"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"secondary"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" key"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"#p0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Book")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("importBooks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" deposit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Date")]),a._v(" date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("h4",{attrs:{id:"cacheconfig"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cacheconfig"}},[a._v("#")]),a._v(" @CacheConfig")]),a._v(" "),s("p",[s("strong",[s("code",[a._v("@CacheConfig")]),a._v(" 用于定义公共缓存配置")]),a._v("。")]),a._v(" "),s("p",[a._v("与前面的缓存注解不同，这是一个类级别的注解。")]),a._v(" "),s("p",[a._v("如果类的所有操作都是缓存操作，你可以使用"),s("code",[a._v("@CacheConfig")]),a._v("来指定类，省去一些配置。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@CacheConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"books"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("BookRepositoryImpl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("implements")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("BookRepository")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Cacheable")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Book")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findBook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ISBN")]),a._v(" isbn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("h2",{attrs:{id:"三、spring-boot-cache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、spring-boot-cache"}},[a._v("#")]),a._v(" 三、Spring Boot Cache")]),a._v(" "),s("blockquote",[s("p",[a._v("详见："),s("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/reference/html/spring-boot-features.html#boot-features-caching",target:"_blank",rel:"noopener noreferrer"}},[a._v("Spring Boot Cache 特性官方文档"),s("OutboundLink")],1)])]),a._v(" "),s("p",[a._v("Spring Boot Cache 是在 Spring Cache 的基础上做了封装，使得使用更为便捷。")]),a._v(" "),s("h3",{attrs:{id:"spring-boot-cache-快速入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-boot-cache-快速入门"}},[a._v("#")]),a._v(" Spring Boot Cache 快速入门")]),a._v(" "),s("p",[a._v("（1）引入依赖")]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-boot-starter-cache"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("\x3c!-- 按序引入需要的缓存库 --\x3e")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-boot-starter-data-redis"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),s("p",[a._v("（2）缓存配置")]),a._v(" "),s("p",[a._v("例如，选用缓存为 redis，则需要配置 redis 相关的配置项（如：数据源、连接池等配置信息）")]),a._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 缓存类型，支持类型：GENERIC、JCACHE、EHCACHE、HAZELCAST、INFINISPAN、COUCHBASE、REDIS、CAFFEINE、SIMPLE")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("spring.cache.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("redis")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 全局缓存时间")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("spring.cache.redis.time-to-live")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("60s")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Redis 配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("spring.redis.database")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("spring.redis.host")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("localhost")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("spring.redis.port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("6379")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("spring.redis.password")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("=")]),a._v("\n")])])]),s("p",[a._v("（3）使用 "),s("code",[a._v("@EnableCaching")]),a._v(" 开启缓存")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@EnableCaching")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@SpringBootApplication")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Application")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("（4）缓存注解（"),s("code",[a._v("@Cacheable")]),a._v("、"),s("code",[a._v("@CachePut")]),a._v("、"),s("code",[a._v("@CacheEvit")]),a._v(" 等）使用方式与 Spring Cache 完全一样")]),a._v(" "),s("h2",{attrs:{id:"四、jetcache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、jetcache"}},[a._v("#")]),a._v(" 四、JetCache")]),a._v(" "),s("blockquote",[s("p",[a._v("JetCache 是一个基于 Java 的缓存系统封装，提供统一的 API 和注解来简化缓存的使用。 JetCache 提供了比 SpringCache 更加强大的注解，可以原生的支持 TTL、两级缓存、分布式自动刷新，还提供了"),s("code",[a._v("Cache")]),a._v("接口用于手工缓存操作。 当前有四个实现，"),s("code",[a._v("RedisCache")]),a._v("、"),s("code",[a._v("TairCache")]),a._v("（此部分未在 github 开源）、"),s("code",[a._v("CaffeineCache")]),a._v("(in memory)和一个简易的"),s("code",[a._v("LinkedHashMapCache")]),a._v("(in memory)，要添加新的实现也是非常简单的。")]),a._v(" "),s("p",[a._v("详见："),s("a",{attrs:{href:"https://github.com/alibaba/jetcache",target:"_blank",rel:"noopener noreferrer"}},[a._v("jetcache Github"),s("OutboundLink")],1)])]),a._v(" "),s("h3",{attrs:{id:"jetcache-快速入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jetcache-快速入门"}},[a._v("#")]),a._v(" jetcache 快速入门")]),a._v(" "),s("p",[a._v("如果使用 Spring Boot，可以按如下的方式配置（这里使用了 jedis 客户端连接 redis，如果需要集群、读写分离、异步等特性支持请使用"),s("a",{attrs:{href:"https://github.com/alibaba/jetcache/wiki/RedisWithLettuce_CN",target:"_blank",rel:"noopener noreferrer"}},[a._v("lettuce"),s("OutboundLink")],1),a._v("客户端）。")]),a._v(" "),s("p",[a._v("（1）引入 POM")]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alicp.jetcache"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("jetcache-starter-redis"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("2.5.14"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),s("p",[a._v("（2）配置")]),a._v(" "),s("p",[a._v("配置一个 spring boot 风格的 application.yml 文件，把他放到资源目录中")]),a._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("jetcache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("statIntervalMinutes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("15")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("areaInCacheName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("local")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" linkedhashmap\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("keyConvertor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" fastjson\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("remote")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" redis\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("keyConvertor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" fastjson\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("valueEncoder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" java\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("valueDecoder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" java\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("poolConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("minIdle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("maxIdle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("maxTotal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 127.0.0.1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6379")]),a._v("\n")])])]),s("p",[a._v("（3）开启缓存")]),a._v(" "),s("p",[a._v("然后创建一个 App 类放在业务包的根下，EnableMethodCache，EnableCreateCacheAnnotation 这两个注解分别激活 Cached 和 CreateCache 注解，其他和标准的 Spring Boot 程序是一样的。这个类可以直接 main 方法运行。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("package")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("company"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mypackage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("alicp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jetcache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("anno"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("EnableCreateCacheAnnotation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("alicp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jetcache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("anno"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("EnableMethodCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("boot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SpringApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("boot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("autoconfigure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SpringBootApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@SpringBootApplication")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@EnableMethodCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("basePackages "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"com.company.mypackage"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@EnableCreateCacheAnnotation")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MySpringBootApp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SpringApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MySpringBootApp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("（4）API 基本使用")]),a._v(" "),s("p",[a._v("创建缓存实例")]),a._v(" "),s("p",[a._v("通过 @CreateCache 注解创建一个缓存实例，默认超时时间是 100 秒")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@CreateCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("expire "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Cache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Long")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserDO")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" userCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("用起来就像 map 一样")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserDO")]),a._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" userCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123L")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nuserCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123L")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nuserCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("remove")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123L")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("创建一个两级（内存+远程）的缓存，内存中的元素个数限制在 50 个。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@CreateCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"UserService.userCache"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" expire "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" cacheType "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("CacheType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("BOTH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" localLimit "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Cache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Long")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserDO")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" userCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("name 属性不是必须的，但是起个名字是个好习惯，展示统计数据的使用，会使用这个名字。如果同一个 area 两个 @CreateCache 的 name 配置一样，它们生成的 Cache 将指向同一个实例。")]),a._v(" "),s("p",[a._v("创建方法缓存")]),a._v(" "),s("p",[a._v("使用 @Cached 方法可以为一个方法添加上缓存。JetCache 通过 Spring AOP 生成代理，来支持缓存功能。注解可以加在接口方法上也可以加在类方法上，但需要保证是个 Spring bean。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("interface")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserService")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Cached")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"UserService.getUserById"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" expire "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3600")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getUserById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("h2",{attrs:{id:"五、j2cache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、j2cache"}},[a._v("#")]),a._v(" 五、j2cache")]),a._v(" "),s("h2",{attrs:{id:"六、总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、总结"}},[a._v("#")]),a._v(" 六、总结")]),a._v(" "),s("p",[a._v("使用缓存框架，使得开发缓存功能非常便捷。")]),a._v(" "),s("p",[a._v("如果你的系统只需要使用一种缓存，那么推荐使用 Spring Boot Cache。Spring Boot Cache 在 Spring Cache 基础上做了封装，使用更简单、方便。")]),a._v(" "),s("p",[a._v("如果你的系统需要使用多级缓存，那么推荐使用 jetcache。")]),a._v(" "),s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[a._v("#")]),a._v(" 参考资料")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.jcp.org/en/jsr/detail?id=107",target:"_blank",rel:"noopener noreferrer"}},[a._v("JSR107"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/integration.html#cache",target:"_blank",rel:"noopener noreferrer"}},[a._v("Spring Cache 官方文档"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/reference/html/spring-boot-features.html#boot-features-caching",target:"_blank",rel:"noopener noreferrer"}},[a._v("Spring Boot Cache 特性官方文档"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://gitee.com/ld/J2Cache",target:"_blank",rel:"noopener noreferrer"}},[a._v("J2Cache Gitee"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/alibaba/jetcache",target:"_blank",rel:"noopener noreferrer"}},[a._v("jetcache Github"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/alibaba/jetcache/wiki/Home_CN",target:"_blank",rel:"noopener noreferrer"}},[a._v("jetcache wiki"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);