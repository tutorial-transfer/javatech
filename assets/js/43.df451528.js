(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{430:function(t,a,s){"use strict";s.r(a);var e=s(13),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"shiro-应用指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#shiro-应用指南"}},[t._v("#")]),t._v(" Shiro 应用指南")]),t._v(" "),s("blockquote",[s("p",[t._v("Shiro 是一个安全框架，具有认证、授权、加密、会话管理功能。")])]),t._v(" "),s("h2",{attrs:{id:"一、shiro-简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、shiro-简介"}},[t._v("#")]),t._v(" 一、Shiro 简介")]),t._v(" "),s("h3",{attrs:{id:"shiro-特性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#shiro-特性"}},[t._v("#")]),t._v(" Shiro 特性")]),t._v(" "),s("p",{attrs:{align:"center"}},[s("img",{attrs:{src:"http://dunwu.test.upcdn.net/cs/java/javaweb/standalone/security/shiro/shiro-features.png"}})]),t._v(" "),s("p",[t._v("核心功能：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Authentication")]),t._v(" - "),s("strong",[t._v("认证")]),t._v("。验证用户是不是拥有相应的身份。")]),t._v(" "),s("li",[s("strong",[t._v("Authorization")]),t._v(" - "),s("strong",[t._v("授权")]),t._v("。验证某个已认证的用户是否拥有某个权限；即判断用户是否能做事情，常见的如：验证某个用户是否拥有某个角色。或者细粒度的验证某个用户对某个资源是否具有某个权限。")]),t._v(" "),s("li",[s("strong",[t._v("Session Manager")]),t._v(" - "),s("strong",[t._v("会话管理")]),t._v("。即用户登录后就是一次会话，在没有退出之前，它的所有信息都在会话中。会话可以是普通 JavaSE 环境的，也可以是如 Web 环境的。")]),t._v(" "),s("li",[s("strong",[t._v("Cryptography")]),t._v(" - "),s("strong",[t._v("加密")]),t._v("。保护数据的安全性，如密码加密存储到数据库，而不是明文存储。")])]),t._v(" "),s("p",[t._v("辅助功能：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Web Support")]),t._v(" - "),s("strong",[t._v("Web 支持")]),t._v("。可以非常容易的集成到 Web 环境；")]),t._v(" "),s("li",[s("strong",[t._v("Caching")]),t._v(" - "),s("strong",[t._v("缓存")]),t._v("。比如用户登录后，其用户信息、拥有的角色 / 权限不必每次去查，这样可以提高效率；")]),t._v(" "),s("li",[s("strong",[t._v("Concurrency")]),t._v(" - "),s("strong",[t._v("并发")]),t._v("。Shiro 支持多线程应用的并发验证，即如在一个线程中开启另一个线程，能把权限自动传播过去；")]),t._v(" "),s("li",[s("strong",[t._v("Testing")]),t._v(" - "),s("strong",[t._v("测试")]),t._v("。提供测试支持；")]),t._v(" "),s("li",[s("strong",[t._v("Run As")]),t._v(" - "),s("strong",[t._v("运行方式")]),t._v("。允许一个用户假装为另一个用户（如果他们允许）的身份进行访问；")]),t._v(" "),s("li",[s("strong",[t._v("Remember Me")]),t._v(" - "),s("strong",[t._v("记住我")]),t._v("。即一次登录后，下次再访问免登录。")])]),t._v(" "),s("blockquote",[s("p",[t._v("🔔 注意：Shiro 不会去维护用户、维护权限；这些需要我们自己去提供；然后通过相应的接口注入给 Shiro 即可。")])]),t._v(" "),s("h3",{attrs:{id:"shiro-架构概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#shiro-架构概述"}},[t._v("#")]),t._v(" Shiro 架构概述")]),t._v(" "),s("p",{attrs:{align:"center"}},[s("img",{attrs:{src:"http://dunwu.test.upcdn.net/cs/java/javaweb/standalone/security/shiro/ShiroBasicArchitecture.png"}})]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("Subject")]),t._v(" - "),s("strong",[t._v("主题")]),t._v("。它代表当前用户，"),s("code",[t._v("Subject")]),t._v(" 可以是一个人，但也可以是第三方服务、守护进程帐户、时钟守护任务或者其它——当前和软件交互的任何事件。"),s("code",[t._v("Subject")]),t._v(" 是 Shiro 的入口。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Principals")]),t._v(" 是 "),s("code",[t._v("Subject")]),t._v(" 的“识别属性”。"),s("code",[t._v("Principals")]),t._v(" 可以是任何可以识别 "),s("code",[t._v("Subject")]),t._v(" 的东西，例如名字（姓氏），姓氏（姓氏或姓氏），用户名，社会保险号等。当然，"),s("code",[t._v("Principals")]),t._v(" 在应用程序中最好是惟一的。")]),t._v(" "),s("li",[s("code",[t._v("Credentials")]),t._v(" 通常是仅由 "),s("code",[t._v("Subject")]),t._v(" 知道的秘密值，用作他们实际上“拥有”所主张身份的佐证 凭据的一些常见示例是密码，生物特征数据（例如指纹和视网膜扫描）以及 X.509 证书。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("SecurityManager")]),t._v(" - "),s("strong",[t._v("安全管理")]),t._v("。它是 Shiro 的核心，所有与安全有关的操作（认证、授权、及会话、缓存的管理）都与 "),s("code",[t._v("SecurityManager")]),t._v(" 交互，且它管理着所有 "),s("code",[t._v("Subject")]),t._v("。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Realm")]),t._v(" - "),s("strong",[t._v("域")]),t._v("。用于访问安全相关数据，可以视为应用自身的数据源，需要开发者自己实现。Shiro 会通过 "),s("code",[t._v("Realm")]),t._v(" 获取安全数据（如用户、角色、权限），就是说 "),s("code",[t._v("SecurityManager")]),t._v(" 要验证用户身份，那么它需要从 "),s("code",[t._v("Realm")]),t._v(" 获取相应的用户进行比较以确定用户身份是否合法；也需要从 Realm 得到用户相应的角色/权限进行验证用户是否能进行操作；可以把 "),s("code",[t._v("Realm")]),t._v(" 看成 DataSource，即安全数据源。")])])]),t._v(" "),s("h3",{attrs:{id:"securitymanager"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#securitymanager"}},[t._v("#")]),t._v(" SecurityManager")]),t._v(" "),s("p",[s("code",[t._v("SecurityManager")]),t._v(" 是 Shiro 框架核心中的核心，它相当于 Shiro 的总指挥，负责调度所有行为，包括：认证、授权、获取安全数据（调用 "),s("code",[t._v("Realm")]),t._v("）、会话管理等。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://dunwu.test.upcdn.net/cs/java/javaweb/standalone/security/shiro/ShiroArchitecture.png",alt:"img"}})]),t._v(" "),s("p",[s("code",[t._v("SecurityManager")]),t._v(" 聚合了以下组件：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Authenticator")]),t._v(" - 认证器，负责认证。如果用户需要定制认证策略，可以实现此接口。")]),t._v(" "),s("li",[s("strong",[t._v("Authorizer")]),t._v(" - 授权器，负责权限控制。用来决定主体是否有权限进行相应的操作；即控制着用户能访问应用中的哪些功能；")]),t._v(" "),s("li",[s("strong",[t._v("SessionManager")]),t._v(" - 会话管理器。Shiro 抽象了一个自己的 Session 来管理主体与应用之间交互的数据。")]),t._v(" "),s("li",[s("strong",[t._v("SessionDAO")]),t._v(" - 会话 DAO 用于存储会话，需要用户自己实现。")]),t._v(" "),s("li",[s("strong",[t._v("CacheManager")]),t._v(" - 缓存控制器。用于管理如用户、角色、权限等信息的缓存。")]),t._v(" "),s("li",[s("strong",[t._v("Cryptography")]),t._v(" - 密码器。用于对数据加密、解密。")])]),t._v(" "),s("h2",{attrs:{id:"二、shiro-认证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、shiro-认证"}},[t._v("#")]),t._v(" 二、Shiro 认证")]),t._v(" "),s("h3",{attrs:{id:"认证-subject"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#认证-subject"}},[t._v("#")]),t._v(" 认证 Subject")]),t._v(" "),s("p",[t._v("验证 Subject 的过程可以有效地分为三个不同的步骤：")]),t._v(" "),s("p",[t._v("（1）收集 "),s("code",[t._v("Subject")]),t._v(" 提交的 "),s("code",[t._v("Principals")]),t._v(" 和 "),s("code",[t._v("Credentials")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Example using most common scenario of username/password pair:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UsernamePasswordToken")]),t._v(" token "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UsernamePasswordToken")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//"Remember Me" built-in:')]),t._v("\ntoken"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRememberMe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("（2）提交 "),s("code",[t._v("Principals")]),t._v(" 和 "),s("code",[t._v("Credentials")]),t._v(" 以进行身份验证。")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Subject")]),t._v(" currentUser "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityUtils")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSubject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\ncurrentUser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("（3）如果提交成功，则允许访问，否则重试身份验证或阻止访问。")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    currentUser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UnknownAccountException")]),t._v(" uae "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IncorrectCredentialsException")]),t._v(" ice "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockedAccountException")]),t._v(" lae "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExcessiveAttemptsException")]),t._v(" eae "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" your own "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthenticationException")]),t._v(" ae "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//unexpected error?")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"remembered-和-authenticated"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#remembered-和-authenticated"}},[t._v("#")]),t._v(" Remembered 和 Authenticated")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Remembered")]),t._v(" - 记住我。被记住的 "),s("code",[t._v("Subject")]),t._v(" 不是匿名的，并且具有已知的身份（即 "),s("code",[t._v("subject.getPrincipals()")]),t._v(" 是非空的）。 但是，在先前的会话期间，通过先前的身份验证会记住此身份。 如果 "),s("code",[t._v("subject.isRemembered()")]),t._v(" 返回 "),s("code",[t._v("true")]),t._v("，则认为该主题已被记住。")]),t._v(" "),s("li",[s("code",[t._v("Authenticated")]),t._v(" - 已认证。已认证的 "),s("code",[t._v("Subject")]),t._v(" 是在当前会话期间已成功认证的 "),s("code",[t._v("Subject")]),t._v("。 如果 "),s("code",[t._v("subject.isAuthenticated()")]),t._v(" 返回 "),s("code",[t._v("true")]),t._v("，则认为该 "),s("code",[t._v("Subject")]),t._v(" 已通过身份验证。")])]),t._v(" "),s("h3",{attrs:{id:"登出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#登出"}},[t._v("#")]),t._v(" 登出")]),t._v(" "),s("p",[t._v("当 Subject 与应用程序完成交互后，可以调用 "),s("code",[t._v("subject.logout()")]),t._v(" 登出，即放弃所有标识信息。")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("currentUser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("logout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"认证流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#认证流程"}},[t._v("#")]),t._v(" 认证流程")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://dunwu.test.upcdn.net/snap/20200317092427.png",alt:"img"}})]),t._v(" "),s("ol",[s("li",[s("p",[t._v("应用程序代码调用 "),s("code",[t._v("Subject.login")]),t._v(" 方法，传入构造的 "),s("code",[t._v("AuthenticationToken")]),t._v(" 实例，该实例代表最终用户的 "),s("code",[t._v("Principals")]),t._v(" 和 "),s("code",[t._v("Credentials")]),t._v("。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("Subject")]),t._v(" 实例（通常是 "),s("code",[t._v("DelegatingSubject")]),t._v("（或子类））通过调用 "),s("code",[t._v("securityManager.login")]),t._v("（token）委托应用程序的 "),s("code",[t._v("SecurityManager")]),t._v("，在此处开始实际的身份验证工作。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("SecurityManager")]),t._v(" 接收令牌，并通过调用 "),s("code",[t._v("authenticator.authenticate")]),t._v("（token）来简单地委派给其内部 "),s("code",[t._v("Authenticator")]),t._v(" 实例。这几乎总是一个 "),s("code",[t._v("ModularRealmAuthenticator")]),t._v(" 实例，它支持在身份验证期间协调一个或多个 "),s("code",[t._v("Realm")]),t._v(" 实例。")])]),t._v(" "),s("li",[s("p",[t._v("如果为该应用程序配置了多个 "),s("code",[t._v("Realm")]),t._v("，则 "),s("code",[t._v("ModularRealmAuthenticator")]),t._v(" 实例将利用其配置的 "),s("code",[t._v("AuthenticationStrategy")]),t._v(" 发起多域验证尝试。在调用领域进行身份验证之前，期间和之后，将调用 "),s("code",[t._v("AuthenticationStrategy")]),t._v(" 以使其对每个领域的结果做出反应。")])]),t._v(" "),s("li",[s("p",[t._v("请咨询每个已配置的 "),s("code",[t._v("Realm")]),t._v("，以查看其是否支持提交的 "),s("code",[t._v("AuthenticationToken")]),t._v("。 如果是这样，将使用提交的令牌调用支持 "),s("code",[t._v("Realm")]),t._v(" 的 "),s("code",[t._v("getAuthenticationInfo")]),t._v(" 方法。 "),s("code",[t._v("getAuthenticationInfo")]),t._v(" 方法有效地表示对该特定 "),s("code",[t._v("Realm")]),t._v(" 的单个身份验证尝试。")])])]),t._v(" "),s("h3",{attrs:{id:"认证策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#认证策略"}},[t._v("#")]),t._v(" 认证策略")]),t._v(" "),s("p",[t._v("当为一个应用程序配置两个或多个领域时，"),s("code",[t._v("ModularRealmAuthenticator")]),t._v(" 依赖于内部 "),s("code",[t._v("AuthenticationStrategy")]),t._v(" 组件来确定认证尝试成功或失败的条件。")]),t._v(" "),s("p",[t._v("例如，如果只有一个 Realm 成功地对 AuthenticationToken 进行身份验证，而所有其他 Realm 都失败了，那么该身份验证尝试是否被视为成功？还是必须所有领域都成功进行身份验证才能将整体尝试视为成功？或者，如果某个领域成功通过身份验证，是否有必要进一步咨询其他领域？ AuthenticationStrategy 根据应用程序的需求做出适当的决定。")]),t._v(" "),s("p",[s("code",[t._v("AuthenticationStrategy")]),t._v(" 是无状态组件，在尝试进行身份验证时会被查询 4 次（这 4 种交互所需的任何必要状态都将作为方法参数给出）：")]),t._v(" "),s("ul",[s("li",[t._v("在任何领域被调用之前")]),t._v(" "),s("li",[t._v("在调用单个 "),s("code",[t._v("Realm")]),t._v(" 的 "),s("code",[t._v("getAuthenticationInfo")]),t._v(" 方法之前")]),t._v(" "),s("li",[t._v("在调用单个 "),s("code",[t._v("Realm")]),t._v(" 的 "),s("code",[t._v("getAuthenticationInfo")]),t._v(" 方法之后")]),t._v(" "),s("li",[t._v("在所有领域都被调用之后")])]),t._v(" "),s("p",[s("code",[t._v("AuthenticationStrategy")]),t._v(" 还负责汇总每个成功 "),s("code",[t._v("Realm")]),t._v(" 的结果，并将它们“捆绑”成单个 "),s("code",[t._v("AuthenticationInfo")]),t._v(" 表示形式。最终的聚合 "),s("code",[t._v("AuthenticationInfo")]),t._v(" 实例是 "),s("code",[t._v("Authenticator")]),t._v(" 实例返回的结果，也是 Shiro 用来表示主体的最终身份（也称为委托人）的东西。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[s("code",[t._v("AuthenticationStrategy")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/pam/AtLeastOneSuccessfulStrategy.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AtLeastOneSuccessfulStrategy")]),s("OutboundLink")],1)]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("只要有一个 "),s("code",[t._v("Realm")]),t._v(" 成功认证，则整个尝试都被视为成功。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/pam/FirstSuccessfulStrategy.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("FirstSuccessfulStrategy")]),s("OutboundLink")],1)]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("仅使用从第一个成功通过身份验证的 "),s("code",[t._v("Realm")]),t._v(" 返回的信息，所有其他 Realm 将被忽略。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/pam/AllSuccessfulStrategy.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AllSuccessfulStrategy")]),s("OutboundLink")],1)]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("只有所有 "),s("code",[t._v("Realm")]),t._v(" 成功认证，则整个尝试才被视为成功。")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("🔗 更多认证细节可以参考："),s("a",{attrs:{href:"http://shiro.apache.org/authentication.html#apache-shiro-authentication",target:"_blank",rel:"noopener noreferrer"}},[t._v("Apache Shiro Authentication"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"三、shiro-授权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、shiro-授权"}},[t._v("#")]),t._v(" 三、Shiro 授权")]),t._v(" "),s("p",[t._v("授权，也称为访问控制，是管理对资源的访问的过程。 换句话说，控制谁有权访问应用程序中的内容。")]),t._v(" "),s("h3",{attrs:{id:"授权元素"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#授权元素"}},[t._v("#")]),t._v(" 授权元素")]),t._v(" "),s("p",[t._v("授权有三个核心要素：权限、角色和用户。")]),t._v(" "),s("h4",{attrs:{id:"权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#权限"}},[t._v("#")]),t._v(" 权限")]),t._v(" "),s("p",[t._v("权限示例：")]),t._v(" "),s("ul",[s("li",[t._v("打开一个文件")]),t._v(" "),s("li",[t._v("查看 "),s("code",[t._v("/user/list")]),t._v(" web 页面")]),t._v(" "),s("li",[t._v("查询记录")]),t._v(" "),s("li",[t._v("删除一条记录")]),t._v(" "),s("li",[t._v("...")])]),t._v(" "),s("p",[t._v("大多数资源都支持一般的 CRUD 操作。除此以外，对于一些特定的资源，任何有意义的行为都是可以的。基本的设计思路是：权限控制，至少是基于资源和行为。")]),t._v(" "),s("h4",{attrs:{id:"角色"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#角色"}},[t._v("#")]),t._v(" 角色")]),t._v(" "),s("p",[t._v("角色是一个命名实体，通常代表一组行为或职责。这些行为会转化为：谁可以在应用程序中执行哪些行为？谁不可以在程序中执行哪些行为？")]),t._v(" "),s("p",[t._v("角色通常是分配给用户帐户的，因此通过关联，用户可以获得自身角色所赋予的权限。")]),t._v(" "),s("h4",{attrs:{id:"用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用户"}},[t._v("#")]),t._v(" 用户")]),t._v(" "),s("p",[t._v("用户本质上是应用程序的“用户”。")]),t._v(" "),s("p",[t._v("用户（即 Shiro 的 "),s("code",[t._v("Subject")]),t._v("）通过与角色或直接权限的关联在应用程序中执行某些行为。")]),t._v(" "),s("h3",{attrs:{id:"基于角色的授权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于角色的授权"}},[t._v("#")]),t._v(" 基于角色的授权")]),t._v(" "),s("p",[t._v("如果授权是基于角色赋予权限的数据模型，编程模式如下：")]),t._v(" "),s("p",[t._v("【示例一】")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('Subject currentUser = SecurityUtils.getSubject();\n\nif (currentUser.hasRole("administrator")) {\n    //show the admin button\n} else {\n    //don\'t show the button?  Grey it out?\n}\n')])])]),s("p",[t._v("【示例二】")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('Subject currentUser = SecurityUtils.getSubject();\n\n// 检查当前 Subject 是否有某种权限\n// 如果有，直接跳过；如果没有，Shiro 会抛出 AuthorizationException\ncurrentUser.checkRole("bankTeller");\nopenBankAccount();\n')])])]),s("blockquote",[s("p",[t._v("提示：方式二相比方式一，代码更简洁")])]),t._v(" "),s("h3",{attrs:{id:"基于权限的授权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于权限的授权"}},[t._v("#")]),t._v(" 基于权限的授权")]),t._v(" "),s("p",[s("strong",[t._v("更好的授权策略通常是基于权限的授权")]),t._v("。基于权限的授权，由于它和应用程序的原始功能（针对具体资源上的行为）紧密相关，所以基于权限的授权源代码会在功能更改时同步更改（而不是在安全策略发生更改时）。 这意味着与类似的基于角色的授权代码相比，修改代码的影响面要小得多。")]),t._v(" "),s("p",[t._v("【示例】基于对象的权限检查")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Permission")]),t._v(" printPermission "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrinterPermission")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"laserjet4400n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"print"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Subject")]),t._v(" currentUser "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityUtils")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSubject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentUser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isPermitted")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("printPermission"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//show the Print button")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//don't show the button?  Grey it out?")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("在对象中存储权限控制信息，但这种方式较为繁重")]),t._v(" "),s("p",[t._v("【示例】字符串定义权限控制信息")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Subject")]),t._v(" currentUser "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityUtils")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSubject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentUser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isPermitted")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"printer:print:laserjet4400n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//show the Print button")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//don't show the button?  Grey it out?")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("使用 : 分隔，表示资源类型、行为、资源 ID，Shiro 提供了默认实现： "),s("code",[t._v("org.apache.shiro.authz.permission.WildcardPermission")]),t._v("。")]),t._v(" "),s("p",[t._v("这种权限控制方式的好处在于：轻量、灵活。")]),t._v(" "),s("h3",{attrs:{id:"基于注解的授权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于注解的授权"}},[t._v("#")]),t._v(" 基于注解的授权")]),t._v(" "),s("p",[t._v("Shiro 提供了一些用于授权的注解，来进一步简化授权代码。")]),t._v(" "),s("h4",{attrs:{id:"requiresauthentication"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#requiresauthentication"}},[t._v("#")]),t._v(" "),s("code",[t._v("@RequiresAuthentication")])]),t._v(" "),s("p",[s("code",[t._v("@RequiresAuthentication")]),t._v(" 注解要求当前 "),s("code",[t._v("Subject")]),t._v(" 必须是已认证用户才可以访问被修饰的方法。")]),t._v(" "),s("p",[t._v("【示例】")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequiresAuthentication")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateAccount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Account")]),t._v(" userAccount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//this method will only be invoked by a")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Subject that is guaranteed authenticated")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"requiresguest"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#requiresguest"}},[t._v("#")]),t._v(" "),s("code",[t._v("@RequiresGuest")])]),t._v(" "),s("p",[s("code",[t._v("@RequiresGuest")]),t._v(" 注解要求当前 "),s("code",[t._v("Subject")]),t._v(" 的角色是 "),s("code",[t._v("guest")]),t._v(" 才可以访问被修饰的方法。")]),t._v(" "),s("h3",{attrs:{id:"授权流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#授权流程"}},[t._v("#")]),t._v(" 授权流程")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://dunwu.test.upcdn.net/snap/20200317092618.png",alt:"img"}})]),t._v(" "),s("ol",[s("li",[s("p",[t._v("应用程序或框架代码调用任何 "),s("code",[t._v("Subject")]),t._v(" 的 "),s("code",[t._v("hasRole*")]),t._v("，"),s("code",[t._v("checkRole*")]),t._v("，"),s("code",[t._v("isPermitted*")]),t._v(" 或 "),s("code",[t._v("checkPermission*")]),t._v(" 方法，并传入所需的权限或角色。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("Subject")]),t._v(" 实例，通常是 "),s("code",[t._v("DelegatingSubject")]),t._v("（或子类），通过调用 "),s("code",[t._v("securityManager")]),t._v(" 几乎相同的各自 "),s("code",[t._v("hasRole*")]),t._v("，"),s("code",[t._v("checkRole*")]),t._v("，"),s("code",[t._v("isPermitted*")]),t._v(" 或 "),s("code",[t._v("checkPermission*")]),t._v(" 方法来委托 "),s("code",[t._v("SecurityManager")]),t._v(" （实现了 "),s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authz/Authorizer.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("org.apache.shiro.authz.Authorizer")]),s("OutboundLink")],1),t._v(" 接口）处理授权。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("SecurityManager")]),t._v(" 通过调用授权者各自的 "),s("code",[t._v("hasRole*")]),t._v("，"),s("code",[t._v("checkRole*")]),t._v("，"),s("code",[t._v("isPermitted*")]),t._v(" 或 "),s("code",[t._v("checkPermission*")]),t._v(" 方法来中继/委托其内部的 "),s("code",[t._v("org.apache.shiro.authz.Authorizer")]),t._v(" 实例。默认情况下，"),s("code",[t._v("authorizer")]),t._v(" 实例是 "),s("code",[t._v("ModularRealmAuthorizer")]),t._v(" 实例，该实例支持在任何授权操作期间协调一个或多个 "),s("code",[t._v("Realm")]),t._v(" 实例。")])]),t._v(" "),s("li",[s("p",[t._v("检查每个已配置的 "),s("code",[t._v("Realm")]),t._v("，以查看其是否实现相同的 "),s("code",[t._v("Authorizer")]),t._v(" 接口。如果是这样，则将调用 "),s("code",[t._v("Realm")]),t._v(" 各自的 "),s("code",[t._v("hasRole*")]),t._v("，"),s("code",[t._v("checkRole*")]),t._v("，"),s("code",[t._v("isPermitted*")]),t._v(" 或 "),s("code",[t._v("checkPermission*")]),t._v(" 方法。")])])]),t._v(" "),s("blockquote",[s("p",[t._v("🔗 更多授权细节可以参考："),s("a",{attrs:{href:"http://shiro.apache.org/authorization.html#apache-shiro-authorization",target:"_blank",rel:"noopener noreferrer"}},[t._v("Apache Shiro Authorization"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"四、shiro-会话管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、shiro-会话管理"}},[t._v("#")]),t._v(" 四、Shiro 会话管理")]),t._v(" "),s("p",[t._v("Shiro 提供了一套独特的会话管理方案：其 Session 可以使用 Java SE 程序，也可以使用于 Java Web 程序。")]),t._v(" "),s("p",[t._v("在 Shiro 中，"),s("a",{attrs:{href:"http://shiro.apache.org/session-management.html#the-sessionmanager",target:"_blank",rel:"noopener noreferrer"}},[t._v("SessionManager"),s("OutboundLink")],1),t._v(" 负责管理应用所有 "),s("code",[t._v("Subject")]),t._v(" 的会话，如：创建、删除、失效、验证等。")]),t._v(" "),s("p",[t._v("【示例】会话使用示例")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Subject")]),t._v(" currentUser "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityUtils")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSubject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Session")]),t._v(" session "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" currentUser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSession")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsession"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"someKey"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" someValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"会话超时"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#会话超时"}},[t._v("#")]),t._v(" 会话超时")]),t._v(" "),s("p",[t._v("默认情况下，Shiro 中的会话有效期为 30 分钟，超时后，该会话将被 Shiro 视为无效。")]),t._v(" "),s("p",[t._v("可以通过 "),s("code",[t._v("globalSessionTimeout")]),t._v(" 方法设置 Shiro 会话超时时间。")]),t._v(" "),s("h3",{attrs:{id:"会话监听"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#会话监听"}},[t._v("#")]),t._v(" 会话监听")]),t._v(" "),s("p",[t._v("Shiro 提供了 "),s("code",[t._v("SessionListener")]),t._v(" 接口（或 "),s("code",[t._v("SessionListenerAdapter")]),t._v(" 接口），用于监听重要的会话事件，并允许使用者在事件触发时做定制化处理。")]),t._v(" "),s("p",[t._v("【示例】")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShiroSessionListener")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SessionListener")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Logger")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LoggerFactory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLogger")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AtomicInteger")]),t._v(" sessionCount "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AtomicInteger")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onStart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Session")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sessionCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("incrementAndGet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onStop")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Session")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sessionCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decrementAndGet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onExpiration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Session")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sessionCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decrementAndGet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"会话存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#会话存储"}},[t._v("#")]),t._v(" 会话存储")]),t._v(" "),s("p",[t._v("大多数情况下，应用需要保存会话信息，以便在稍后可以使用它。")]),t._v(" "),s("p",[t._v("Shiro 提供了 "),s("code",[t._v("SessionManager")]),t._v(" 接口，负责将针对会话的 CRUD 操作委派给内部组件 "),s("code",[t._v("SessionDAO")]),t._v("，该组件反映了数据访问对象（DAO）设计模式。")]),t._v(" "),s("blockquote",[s("p",[t._v("🔔 注意：由于会话通常具有时效性，所以一般会话天然适合存储于缓存中。存储于 Redis 中是一个不错的选择。")])]),t._v(" "),s("h2",{attrs:{id:"五、realm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、realm"}},[t._v("#")]),t._v(" 五、Realm")]),t._v(" "),s("p",[s("code",[t._v("Realm")]),t._v(" 是 Shiro 访问程序安全相关数据（如：用户、角色、权限）的接口。")]),t._v(" "),s("p",[s("code",[t._v("Realm")]),t._v(" 是有开发者自己实现的，开发者可以通过实现 Realm 接口，接入应用的数据源，如：JDBC、文件、Nosql 等等。")]),t._v(" "),s("h3",{attrs:{id:"认证令牌"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#认证令牌"}},[t._v("#")]),t._v(" 认证令牌")]),t._v(" "),s("p",[t._v("Shiro 支持身份验证令牌。在咨询 Realm 进行认证尝试之前，将调用其支持方法。 如果返回值为 true，则仅会调用其 "),s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/realm/Realm.html#getAuthenticationInfo-org.apache.shiro.authc.AuthenticationToken-",target:"_blank",rel:"noopener noreferrer"}},[t._v("getAuthenticationInfo(token)"),s("OutboundLink")],1),t._v(" 方法。通常，Realm 会检查所提交令牌的类型（接口或类），以查看其是否可以处理它。")]),t._v(" "),s("p",[t._v("令牌认证处理流程如下：")]),t._v(" "),s("ol",[s("li",[t._v("检查用于标识 principal 的令牌（帐户标识信息）。")]),t._v(" "),s("li",[t._v("根据 principal，在数据源中查找相应的帐户数据。")]),t._v(" "),s("li",[t._v("确保令牌提供的凭证与数据存储中存储的凭证匹配。")]),t._v(" "),s("li",[t._v("如果 credentials 匹配，则返回 "),s("code",[t._v("AuthenticationInfo")]),t._v(" 实例。")]),t._v(" "),s("li",[t._v("如果 credentials 不匹配，则抛出 "),s("code",[t._v("AuthenticationException")]),t._v(" 异常。")])]),t._v(" "),s("h3",{attrs:{id:"加密"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#加密"}},[t._v("#")]),t._v(" 加密")]),t._v(" "),s("p",[t._v("通过前文，可以了解：Shiro 需要通过一对 principal 和 credentials 来确认身份是否匹配（即认证）。")]),t._v(" "),s("p",[t._v("一般来说，成熟软件是不允许存储账户、密码这些敏感数据时，使用明文存储。所以，通常要将密码加密后存储。")]),t._v(" "),s("p",[t._v("Shiro 提供了一些加密器，其思想就是用 MD5、SHA 这种数字签名算法，加 Salt，然后转为 Base64 字符串。为了避免被暴力破解，Shiro 使用多次加密的方式获得最终的 credentials 字符串。")]),t._v(" "),s("p",[t._v("【示例】Shiro 加密密码示例")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shiro"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("crypto"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hash"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sha256Hash")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shiro"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("crypto"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RandomNumberGenerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shiro"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("crypto"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecureRandomNumberGenerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//We'll use a Random Number Generator to generate salts.  This")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//is much more secure than using a username as a salt or not")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//having a salt at all.  Shiro makes this easy.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Note that a normal app would reference an attribute rather")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//than create a new RNG every time:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RandomNumberGenerator")]),t._v(" rng "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecureRandomNumberGenerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" salt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rng"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextBytes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Now hash the plain-text password with the random salt and multiple")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//iterations and then Base64-encode the value (requires less space than Hex):")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" hashedPasswordBase64 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sha256Hash")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("plainTextPassword"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" salt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBase64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hashedPasswordBase64"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//save the salt with the new account.  The HashedCredentialsMatcher")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//will need it later when handling login attempts:")]),t._v("\nuser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setPasswordSalt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("salt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nuserDAO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"六、配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、配置"}},[t._v("#")]),t._v(" 六、配置")]),t._v(" "),s("h3",{attrs:{id:"过滤链"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#过滤链"}},[t._v("#")]),t._v(" 过滤链")]),t._v(" "),s("p",[t._v("运行 Web 应用程序时，Shiro 将创建一些有用的默认 Filter 实例。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("Filter Name")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("Class")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("anon")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/filter/authc/AnonymousFilter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("org.apache.shiro.web.filter.authc.AnonymousFilter"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("authc")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/filter/authc/FormAuthenticationFilter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("org.apache.shiro.web.filter.authc.FormAuthenticationFilter"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("authcBasic")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/filter/authc/BasicHttpAuthenticationFilter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("org.apache.shiro.web.filter.authc.BasicHttpAuthenticationFilter"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("logout")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/filter/authc/LogoutFilter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("org.apache.shiro.web.filter.authc.LogoutFilter"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("noSessionCreation")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/filter/session/NoSessionCreationFilter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("org.apache.shiro.web.filter.session.NoSessionCreationFilter"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("perms")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/filter/authz/PermissionsAuthorizationFilter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("org.apache.shiro.web.filter.authz.PermissionsAuthorizationFilter"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("port")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/filter/authz/PortFilter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("org.apache.shiro.web.filter.authz.PortFilter"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("rest")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/filter/authz/HttpMethodPermissionFilter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("org.apache.shiro.web.filter.authz.HttpMethodPermissionFilter"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("roles")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/filter/authz/RolesAuthorizationFilter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("org.apache.shiro.web.filter.authz.RolesAuthorizationFilter"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("ssl")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/filter/authz/SslFilter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("org.apache.shiro.web.filter.authz.SslFilter"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("user")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/filter/authc/UserFilter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("org.apache.shiro.web.filter.authc.UserFilter"),s("OutboundLink")],1)])])])]),t._v(" "),s("h3",{attrs:{id:"rememberme"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rememberme"}},[t._v("#")]),t._v(" RememberMe")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UsernamePasswordToken")]),t._v(" token "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UsernamePasswordToken")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntoken"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRememberMe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityUtils")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSubject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"http://shiro.apache.org/reference.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Shiro 官方文档"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"http://jinnianshilongnian.iteye.com/category/305053",target:"_blank",rel:"noopener noreferrer"}},[t._v("跟我学 Shiro"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://stormpath.com/blog/new-rbac-resource-based-access-control",target:"_blank",rel:"noopener noreferrer"}},[t._v("The New RBAC: Resource-Based Access Control"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);